

<!doctype html>
<html>
<head>
<meta charset="utf-8">
<link media="all" href="../css/base.css" type="text/css" rel="stylesheet">
<link media="all" href="../css/index.css" type="text/css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../css/heloo.img.cut.css" />
<script type="text/javascript" src="../js/jquery.js"></script>
<script src="../js/jquery.js"></script>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta content="" name="Keywords">
<meta content="" name="Description">
<!-- Mobile Devices Support @begin -->
<meta http-equiv="Content-Type" content="application/xhtml+xml;charset=UTF-8">
<meta http-equiv="Cache-Control" content="no-cache,must-revalidate">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="expires" content="0">
<meta name="format-detection" content="telephone=no, address=no">
<meta content="yes" name="apple-mobile-web-app-capable"> <!-- apple devices fullscreen -->
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
<!-- Mobile Devices Support @end -->
<link href="favourite.ico" rel="shortcut icon">
</head>
<body >
    <div class='upload_wrap'>
		<div class='upload'>+<div class="img_show" ></div><input id="head_img"  type="file" accept="image/*" /></div>
    </div>
	<p style='height:800px'></p>
<div class='content_wrap' style='display:none'>
<div class="content">
  <div class="component">
    <div class="overlay">
      <div class="overlay-inner"></div>
    </div>
    <img class="resize-image" src="" alt="image for resizing">
    <button class="btn-crop js-crop">确认裁切</button>
  </div>
</div>
</div>	
	

<script type="text/javascript" src="../js/heloo.img.cut.js"></script>

<script type="text/javascript">
   $(function(){
   
   

	   
	   $('#head_img,#banner_img').change(function(){
	   var that = $(this);
	   var file = this.files[0]; //选择上传的文件
	   console.log(file)
	   var r = new FileReader();
	   r.readAsDataURL(file); //Base64
	   $(r).load(function(){
	    $('.content_wrap').height($('body').height())
	    $('.content_wrap').fadeIn(200);
	    $('.resize-image').attr('src',this.result)

		
		resizeableImage($('.resize-image'),that.attr('id') == 'head_img' ? $('#head_img') : $('#banner_img'));
		/*
		$('.resize-image').bind('load',function(){
		        if($('.resize-image').width()>$(window).width()){
			    	$('.resize-image').width($(window).width() -90);
				}
		})
		*/

		
		if(that.attr('id') != 'head_img'){
		   $('.overlay').css({width:320,height:130,marginLeft:-160})
		}
		else{
		   $('.overlay').css({width:200,height:200,marginLeft:-100})
		}
	    //that.parent().find('.img_show').html('<img src="'+ $('.content_wrap').attr('src_') +'" alt="" />');
	   });
	   });
	   $('#file_upload').delegate('a.img_del','click',function(){
		   $(this).parents('.upload_wrap').remove();
		   if($('#file_upload .upload_wrap').last().find('.img_show').html()==''){
		      $('#file_upload .upload_wrap').last().remove()
		   }
		   addFileUp();
	
	   })
   
	   var addFileUp = function(){

	   	   $('#file_upload').append($('<div class="upload_wrap" style=""><div class="upload">+<div class="img_show" ></div><input class="img_up" type="file" accept="image/*" /></div></div> '));
		   imgEvent();
	   
	
	   }
   
	   var imgEvent = function(){
		   $('.img_up').change(function(){
		   var that = $(this);
		   var parent_ = that.parent().parent()
		   var file = this.files[0]; //选择上传的文件
		   var r = new FileReader();
		   r.readAsDataURL(file); //Base64
		   $(r).load(function(){
		    that.parent().find('.img_show').html('<img src="'+ this.result +'" alt="" /><a class="img_del"></a>');
			that.hide()
		   });
 
		   if(parent_.index()<5){
			   addFileUp();
		   }
   
		   });   	
	
	   }
   
	   if($('#file_upload .upload_wrap').length<4){
		   addFileUp();
	   }   
	   $('.upload_wrap').eq(2).fadeIn(500);
   
      //输出图片路径
      $('.btn_red').click(function(){
   	   var result = [];
   	   $('.upload:visible').each(function(){		 
   		 var url = $(this).find('img').attr('src');		   
   	   	 url ? result.push(url) : null
   	   })
   	   console.log(result)
	   console.log($('.img_show').first().find('img').attr('src')+'《＝头像')
	   console.log($('.img_show').eq(1).find('img').attr('src')+'《＝banner')
      })
	 
   });
</script>
</body>
</html>