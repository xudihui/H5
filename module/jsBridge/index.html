<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>JSBridge</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <script type='text/javascript' src='jsBridge.js'></script>
  </head>
  <body> 
    <section class="page-header">
      <h3>jsBridge v0.9</h3>
	  <a class="btn">设置标题SPA</a>
      <a class="btn">分享</a>
      <a class="btn">进入APP登录</a>
      <a class="btn">获取App用户信息</a>
      <a class="btn">获取App版本信息</a>
      <a class="btn" href='https://hzsmkpay.96225.com/recharge/html/index.html'>跳出去</a>      
      <a class="btn">获取用户token</a>  
	  <a class="btn">pushWindow</a>
	  <a class="btn">我是iphoneX吗</a>
    </section>

    <section class="main-content">
     <h3 >市民卡APP&H5交互步骤:</h3>
      <table>
       <thead>
        <tr>
          <td>序号</td>
          <td>描述</td>  
        </tr>  
       </thead>    
        <tr>
          <td>引入jsBridge</td>
          <td><span onclick='prompt("cdn引用地址：","https://cdnweb04.96225.com/smkapp/js/jsBridge.0.9.js")'>[cdn引用]</span> </td>  
        </tr>                
      </table>
      <h3 >web调用App:</h3>
      <table>
       <thead>
        <tr>
          <td>名称</td>
          <td>示例</td>  
        </tr>  
       </thead>  
        <tr>
          <td>政务网数据统计<a href='#tuy'>参考字典</a></td>
          <td>
            <pre>
jsBridge.govMatter({
  type:'finish',
  sxbm:'33015020000000000000-SP-0009',
  mobile:'13213123120'
})
//type[String]：统计类型('accept'代表受理、'finish'代表办结)
//sxbm[String]: 事项编号(参考字典)
//mobile[String]: 当前用户手机号
            </pre>       
          </td>    
        </tr>  	   
       <tr>
          <td>获取用户Token</td>
          <td>
            <pre>
jsBridge.getToken(callback);
//callbackp[Function]: 回调匿名函数(function(token){alert(token)})
//v0.3修正内容：如果在APP内部，并且获取到的token为空，直接唤起APP登录页
            </pre>       
          </td>   
        </tr>         
        <tr>
          <td>设置标题</td>
          <td>
            <pre>
jsBridge.setTitle(title);
//title[String]: 标题名称
            </pre>       
          </td>   
        </tr>
        <tr>
          <td>分享</td>
          <td><pre>
jsBridge.setShareInfo({
   title:'分享标题(String)',
   content:'分享正文(String)',
   imageUrl:'图片地址(String)',
   shareUrl:'链接地址(String)',
   success:'分享成功(Function [appVersion])',
   error:'分享取消或者失败(Function [appVersion])'
 })
 //所有字段必填*
 </pre></td>    
        </tr> 
        <tr>
          <td>进入APP功能页</td>
          <td>
            <pre>
jsBridge.gotoNative(pageName);
//pageName[String]: 登录/注册/退出
//v0.7修正内容：修复IOS登录 schema地址跳转，修复完：IOS在已登录的状态下无法唤起登录
            </pre>       
          </td>    
        </tr>           
      </table>

    
      <h3 >App调用web定义的方法(必须暴露在全局)</h3>
      <table>
       <thead>
        <tr>
          <td>方法名</td>
          <td>示例</td>  
        </tr>  
       </thead>    
        <tr>
          <td>分享结果</td>
          <td>getMessageFromApp</td>  
        </tr>
        <tr>
          <td>用户信息传递</td>
          <td>getDataFromApp</td>    
        </tr>    
        <tr>
          <td>用户Token输出</td>
          <td>sendTokenToWap</td>    
        </tr>                
      </table>
    
      <h3 >URL拦截</h3>
      <table>
       <thead>
        <tr>
          <td>方法名</td>
          <td>拦截地址格式</td>  
        </tr>  
       </thead>    
        <tr>
          <td>获取用户Token</td>
          <td>"smkapp://postSMKUserToken"</td>  
        </tr>
        <tr>
          <td>设置标题</td>
          <td>"smkapp://setTitle/{TITLE}"</td>  
        </tr>        
        <tr>
          <td>分享</td>
          <td>"smkshare:{"shareUrl":"{lineLink}","title":"{shareTitle}","content":"{descContent}","imageUrl":"{imgUrl}"}"</td>    
        </tr> 
        <tr>
          <td>进入APP功能页</td>
          <td>"smknative:open{PAGE}"</td>    
        </tr>           
      </table>   
	  
      <h3 id='tuy' name="tuy">附录字典(事项编号)</h3>
      <table>
       <thead>
        <tr>
          <td>事项名称</td>
          <td>事项编码</td>  
        </tr>  
       </thead>    
        <tr>
          <td>市民卡账户充值/账户充值卡销售</td>
          <td>33015020000000000000-SP-0005</td>  
        </tr>
        <tr>
          <td>参保缴费凭证查询</td>
          <td>33015020000000000000-SP-0007</td>  
        </tr> 
        <tr>
          <td>缴费记录</td>
          <td>33015020000000000000-SP-0008</td>  
        </tr> 
        <tr>
          <td>医保查询</td>
          <td>33015020000000000000-SP-0009</td>  
        </tr> 
        <tr>
          <td>医保账户共济</td>
          <td>33015020000000000000-SP-0023</td>  
        </tr> 
        <tr>
          <td>充话费</td>
          <td>33015020000000000000-SP-0013</td>  
        </tr> 
        <tr>
          <td>水费</td>
          <td>33015020000000000000-SP-0014</td>  
        </tr> 
        <tr>
          <td>燃气费</td>
          <td>33015020000000000000-SP-0015</td>  
        </tr> 
        <tr>
          <td>电视费</td>
          <td>33015020000000000000-SP-0016</td>  
        </tr> 		
        <tr>
          <td>宽带费</td>
          <td>33015020000000000000-SP-0017</td>  
        </tr> 
        <tr>
          <td>停车费</td>
          <td>33015020000000000000-SP-0018</td>  
        </tr> 
        <tr>
          <td>市民卡交易查询</td>
          <td>33015020000000000000-SP-0021</td>  
        </tr> 		
        <tr>
          <td>市民卡服务网点查询</td>
          <td>33015020000000000000-SP-0022</td>  
        </tr> 			
      </table>  	  

<h3>代码贡献</h3>
<ul>
  <li>欢迎大家通过<a href="https://github.com/xudihui/H5/issues" > issue </a>反馈使用问题</li>
  <li><a href="https://github.com/xudihui/H5/pulls" > pulls </a>贡献您的代码！</li>
</ul>         
</section>
<script type="text/javascript">
  var $ = function(el){
        return document.querySelectorAll(el)
  }
  var btns = $('.btn');
  var isIphoneX = function (){
		return /iphone/gi.test(navigator.userAgent) && (screen.height == 812 && screen.width == 375)
  }
  
  btns[0].onclick = function(){
     var title = prompt('请输入新title名','hello Word!');
     if(title){
        jsBridge.setTitle(title)
     }
  }
  btns[1].onclick = function(){
     jsBridge.setShareInfo({
       title:'分享标题%%%',
       content:'分享正文%%%',
       imageUrl:'http://activity.96225.com/exthtml/asevenf/img/Forward.jpg',
       shareUrl:'https://www.96225.com',
       success:function(v){alert('成功'+v)},
       error:function(v){alert('失败'+v)}
     })
  }
  btns[2].onclick = function(){
     jsBridge.gotoNative('LoginView');
  } 

  btns[4].onclick = function(){
    var self = this;
    appendP(self,navigator.userAgent);
  } 
  btns[6].onclick = function(){
      jsBridge.getToken(function(i){prompt('用户Token:',i)});
  }   
  btns[7].onclick = function(){
      location.href='smkapp://pushWindow:{"url":"https://activity.96225.com/exthtml/AppVirtualCard/pages/index.html?type=help","title":"元迪"}'
  }
  btns[8].onclick = function(){
	var self = this;
	appendP(self,isIphoneX() ? '土豪您好，确实是iphoneX！' : '很遗憾，你不是土豪');
  }    
//动态插入P标签
var appendP = function(father,child){
  var p = document.createElement("p");
  p.innerHTML = child;  
  father.appendChild(p);
  setTimeout(function(){
    father.removeChild(p);
  },10000)
}


//从app获取用户信息
var getDataFromApp = function(data) {
    //alert('执行')
    btns[3].onclick = function(){
     var self = this;
     appendP(self,data);
    }     
    var o = JSON.parse(data);
}

</script>
  
  </body>
</html>
