
<!DOCTYPE html>
<html>
<head>
    <title>Page Events</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
    <meta charset="utf-8">
    <script>
// 对Date的扩展，将 Date 转化为指定格式的String
// 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符， 
// 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字) 
// 例子： 
// (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423 
// (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18 
Date.prototype.Format = function (fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "h+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}
        var isPageHide = false;           
        function writeLogs(msg,color){
        	var li = document.createElement("li");
        	li.innerHTML = new Date().Format("hh:mm:ss.S")   + " " + msg;
        	li.style.color = color || '#777';
        	document.querySelector("ul").appendChild(li);
        }
        window.addEventListener('load', function(){

        	writeLogs('执行onload');
        	document.querySelector("#changeColor").onclick = function(){
        		document.querySelector("body").style.background = document.querySelector("body").style.background == "yellow" ? "white":"yellow";
        	}
        })
        window.addEventListener('pagehide', function( e ){
        	// alert('pagehide'); //pagehide的alert无效
            isPageHide = true;
        	writeLogs("执行pagehide");
        	writeLogs(e.persisted ? "页面被压入缓存栈":"页面直接移除");
        })

        window.addEventListener('pageshow', function( e ){

        	//alert('pageshow');
		 	if(isPageHide) { 
                alert(111)
		 		//window.location.reload(); 
		 	}         	
        	writeLogs("执行pageshow",'red');
        	writeLogs(e.persisted ? "页面从缓存中读取":"页面从服务器请求",'red');
        })
    </script>
</head>
<body id="body" style='padding:10px'>
	<a href="http://192.168.0.157:8080/dev/github/H5/module/jsBridge/index.html">跳出去</a>
	<input type="button" id="changeColor" value="切换背景" />
	<ul></ul>
</body>
</html>